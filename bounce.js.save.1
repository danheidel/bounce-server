var bouncy = require('bouncy');
var util = require('util');
var config = process.argv[2];
var port = config.bouncePort;
var port = process.argv[2];
console.log(util.inspect(process.argv, {showHidden: true, depth: null}));
//console.log(typeof(config));

if(typeof port === 'undefined'){
	console.error('no port defined');
	process.exit();
}

function trimAt(iString, iChar){
	var pos = iString.indexOf(iChar);
	if(pos > -1){
		return iString.substring(0, pos);
	}
	return iString;
}

var server = bouncy(function(req, res, bounce){
	console.log('incoming request');
	var baseHost = trimAt(req.headers.host,':');
	console.log(baseHost);
	if((baseHost === 'danheidel.net') ||
		(baseHost === 'www.danheidel.net')){
		console.log('loading danheidel.net');
		bounce(3001);
	}
	else if((baseHost === 'ourstupiduniverse.net') ||
		(baseHost === 'www.ourstupiduniverse.net')){
		console.log('loading ourstupiduniverse.net');
		bounce(3002);
	}
	else {
		console.log('404\'d! ' + baseHost);
		bounce(3000);
	}
});

server.listen(port);
console.log('bounce listening at: ' + port);
